<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ClickCloud | Rapid deployment</title>
    <link rel="stylesheet" type="text/css" href="static/styles/font-awesome.css" />
    <!--[if IE 7]>
    <link rel="stylesheet" type="text/css" href="static/styles/font-awesome-ie7.min.css">
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="static/styles/master.css" />
    <link rel="stylesheet" type="text/css" href="static/styles/index.css" /><!-- Only Hadoop Install -->
    <script type="text/javascript" src="static/scripts/click.js"></script>
    <script type="text/javascript">
        window.addEventListener('load', function () {
            crumbsContent = crumbs([{ name: 'Home', url: 'index.html' }, { name: 'Hadoop', url: '' }]);
            var crumbs_ = document.getElementById('crumbs');
            if (!!crumbs_) {
                crumbs_.insertAdjacentHTML('afterBegin', crumbsContent);
            }

            clickgo(document.getElementsByClassName('alert'));
            clicktoggle(document.getElementById('_01'),
                        document.getElementById('_01_'));
            clickfocus(document.getElementsByClassName('_focus_'));
        });
    </script>
</head>
<body>
    <div class="row-head">
        <div class="column-logo">
        </div>
    </div>
    <div class="row-navigation">
        <div class="column-icons">
        </div>
        <div class="column-crumbs">
            <div class="crumbs" id="crumbs"></div>
        </div>
    </div>
    <div class="row-main">
        <div class="column-list">
            <ul>
                <li><a class="_focus_" href="javascript:void(0);"><i class="icon-dashboard icon-large"></i>Dashboard</a></li>
                <li>
                    <a id="_01" focus="1" href="javascript:void(0);"><i class="icon-book icon-large"></i>Hadoop</a>
                    <ul id="_01_">
                        <li><a class="_focus_" href="javascript:void(0);">Install</a></li>
                        <li><a class="_focus_" href="javascript:void(0);">Clean</a></li>
                        <li><a class="_focus_" href="javascript:void(0);">Start</a></li>
                        <li><a class="_focus_" href="javascript:void(0);">Stop</a></li>
                    </ul>
                </li>
                <li><a class="_focus_" href="javascript:void(0);"><i class="icon-bar-chart icon-large"></i>Monitor</a></li>
                <li><a class="_focus_" href="javascript:void(0);"><i class="icon-sitemap icon-large"></i>My Hosts</a></li>
                <li><a class="_focus_" href="javascript:void(0);"><i class="icon-lightbulb icon-large"></i>Issues</a></li>
                <li><a class="_focus_" href="javascript:void(0);"><i class="icon-file icon-large"></i>Other Pages</a></li>
            </ul>
        </div>
        <div class="column-board">
            <div class="title">
                <span class="maintitle">Install Hadoop</span>
                <span class="subtitle">&gt;&gt; This operation needs to provide server login credentials</span>
            </div>
            <div class="alert">
                <i class="icon-ok"></i> Welcome to use <b>ClickCloud</b> Deployment Service, the rapid deployment plan
            </div>
            <!-- Step 1 Start-->
            <div class="magic-name" id="magic-name-machine-number">
                <i class="icon-check-empty icon-large"></i>Select machine number
            </div>
            <div class="magic-mirror" id="magic-mirror-machine-number">
                <div class="machine-number-box">
                    <span>Machine Number </span>
                    <input type="number" id="input-machine-number" value="0" />
                    <input type="button" id="input-machine-number-enter" value="Enter" />
                </div>
            </div>
            <script type="text/javascript">
                window.addEventListener('load', function () {
                    var input_machine_number = document.getElementById('input-machine-number');
                    var input_machine_number_enter = document.getElementById('input-machine-number-enter');

                    var m = new Magic('select-machine-number', 'install-hadoop-and-spark', 0, function (magic, mana) {
                        return input_machine_number.value;
                    });
                    Magician.practice(m);

                    input_machine_number_enter.addEventListener('click', function (e) {
                        m.ready = true; // if not zero
                        var i = document.getElementById('magic-name-machine-number').getElementsByTagName('i')[0];
                        i.classList.remove('icon-check-empty');
                        i.classList.add('icon-check');
                        Magician.fire('install-hadoop-and-spark', null);
                    });
                });
            </script>
            <!-- Step 1 End-->
            <!-- Step 2 Start-->
            <div class="magic-name" id="magic-name-machine-list">
                <i class="icon-check-empty icon-large"></i>Configuration your machine
            </div>
            <div class="magic-mirror" id="magic-mirror-machine-list">
                <table class="machine-list">
                    <tbody>
                        <tr>
                            <th>Name</th>
                            <th>IpAddress</th>
                            <th>HostName</th>
                            <th>UserName</th>
                            <th>Password</th>
                            <th>Master</th>
                            <th>Spark Client</th>
                        </tr>
                        <tr class="machine" id="template-machine" style="display:none;">
                            <td><input class="cell-name" type="text" /></td>
                            <td><input class="cell-ipaddr" type="text" /></td>
                            <td><input class="cell-hostname" type="text" /></td>
                            <td><input class="cell-username" type="text" /></td>
                            <td><input class="cell-passwd" type="text" /></td>
                            <td><input class="cell-is-master" type="checkbox" /></td>
                            <td><input class="cell-is-spark-client" type="checkbox" /></td>
                        </tr>
                    </tbody>
                </table>
                <input id="machine-list-enter" type="button" value="Enter" />
            </div>
            <script type="text/javascript">
                window.addEventListener('load', function () {
                    var template_machine = document.getElementById('template-machine');
                    var machine = template_machine.cloneNode(true);
                    var machine_list_container = template_machine.parentNode;
                    machine.style.display = 'table-row';
                    var ms = [];
                    var getValue = function (machine, className) {
                        var element = machine.getElementsByClassName(className)[0];
                        if (!element) {
                            return null;
                        }
                        else if (element.type == 'checkbox') {
                            return !!element.checked;
                        }
                        return element.value;
                    }
                    var getData = function () {
                        var data = '<?xml version="1.0" encoding="UTF-8"?>';
                        data = data + '<hosts>';
                        for (var _ in ms) {
                            var name = getValue(ms[_], 'cell-name');
                            if (!name || name == '') {
                                return null;
                            }
                            data = data + '<host name="' + name + '">';
                            var ipaddr = getValue(ms[_], 'cell-ipaddr');
                            if (!ipaddr || ipaddr == '') {
                                return null;
                            }
                            data = data + '<ipaddr>' + ipaddr + '</ipaddr>';
                            var hostname = getValue(ms[_], 'cell-hostname');
                            if (!hostname || hostname == '') {
                                return null;
                            }
                            data = data + '<hostname>' + hostname + '</hostname>';
                            var username = getValue(ms[_], 'cell-username');
                            if (!username || username == '') {
                                return null;
                            }
                            data = data + '<username>' + username + '</username>';
                            var passwd = getValue(ms[_], 'cell-passwd');
                            if (!passwd || passwd == '') {
                                return null;
                            }
                            data = data + '<password>' + passwd + '</password>';
                            data = data + '<keys>';
                            var is_master = getValue(ms[_], 'cell-is-master');
                            if (!!is_master) {
                                data = data + 'hadoop_master';
                            }
                            else {
                                data = data + 'hadoop_slave';
                            }
                            var is_spark_client = getValue(ms[_], 'cell-is-spark-client');
                            if (!!is_spark_client) {
                                data = data + ',spark_client';
                            }
                            data = data + '</keys>';
                            data = data + '</host>';
                        }
                        data = data + '</hosts>';
                        return data;
                    }
                    var current_mana = 0;
                    var m = new Magic('configuration-your-machine', 'install-hadoop-and-spark', 1, function (magic, mana) {
                        if (current_mana > mana) {
                            for (var i = 0; i < current_mana - mana; i++) {
                                _ = ms.pop();
                                machine_list_container.removeChild(_);
                            }
                        }
                        else if (mana > current_mana) {
                            for (var i = 0; i < mana - current_mana; i++) {
                                var _ = machine.cloneNode(true);
                                machine_list_container.appendChild(_);
                                ms.push(_);
                            }
                        }
                        current_mana = mana;
                        var data = getData();
                        if (!data) {
                            magic.ready = false;
                            var i = document.getElementById('magic-name-machine-list').getElementsByTagName('i')[0];
                            i.classList.remove('icon-check');
                            i.classList.add('icon-check-empty');
                        }
                        else {
                            magic.ready = true;// If configured correctly
                            var i = document.getElementById('magic-name-machine-list').getElementsByTagName('i')[0];
                            i.classList.remove('icon-check-empty');
                            i.classList.add('icon-check');
                        }
                        return data;
                    });
                    Magician.practice(m);
                    // retry fire when you modify some values
                    var machine_list_enter = document.getElementById('machine-list-enter');
                    machine_list_enter.addEventListener('click', function () {
                        Magician.fire('install-hadoop-and-spark', null);
                    });
                });
            </script>
            <!-- Step 2 End-->
            <!-- Step 3 Start-->
            <div class="magic-name" id="magic-name-commit">
                <i class="icon-check-empty icon-large"></i>Commit Task
            </div>
            <div class="magic-mirror" id="magic-mirror-commit">
                <input type="button" id="input-install-button" value="Install" />
            </div>
            <script type="text/javascript">
                window.addEventListener('load', function () {
                    var data = null;
                    var m = new Magic('commit-task', 'install-hadoop-and-spark', 2, function (magic, mana) {
                        data = mana;
                        if (!data) {
                            magic.ready = false;
                            var i = document.getElementById('magic-name-commit').getElementsByTagName('i')[0];
                            i.classList.remove('icon-check');
                            i.classList.add('icon-check-empty');
                        }
                    });
                    Magician.practice(m);
                    var input_install_button = document.getElementById('input-install-button');
                    input_install_button.addEventListener('click', function () {
                        if (!data) {
                            m.ready = false;
                            var i = document.getElementById('magic-name-commit').getElementsByTagName('i')[0];
                            i.classList.remove('icon-check');
                            i.classList.add('icon-check-empty');
                        }
                        else {
                            m.ready = true;
                            var i = document.getElementById('magic-name-commit').getElementsByTagName('i')[0];
                            i.classList.remove('icon-check-empty');
                            i.classList.add('icon-check');
                        }
                        if (m.ready) {
                            alert(data);
                            var xmlhttp;
                            if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
                                xmlhttp = new XMLHttpRequest();
                            }
                            else {// code for IE6, IE5
                                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                            }
                            xmlhttp.open("POST", "ajax-handler", true);
			    xmlhttp.setRequestHeader("command", "hadoop.install.main");
                            xmlhttp.setRequestHeader("Content-type", "text/xml");
                            xmlhttp.send(data);
                        }
                    });
                });
            </script>
            <!-- Step 3 End-->
        </div>
    </div>
</body>
</html>
